<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TikTok日区定价计算器（智能物流版）</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f7f7f7;
      max-width: 700px;
      margin: auto;
    }
    h2 {
      color: #333;
      text-align: center;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin: 0.5rem 0 0.2rem;
      font-weight: bold;
      color: #555;
    }
    input, select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      border-radius: 4px;
      font-size: 16px;
      width: 100%;
      margin-top: 1rem;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #e8f5e8;
      border-radius: 4px;
      border-left: 4px solid #28a745;
    }
    .logistics-info {
      margin-top: 1rem;
      padding: 0.8rem;
      background: #e3f2fd;
      border-radius: 4px;
      font-size: 14px;
      color: #1976d2;
    }
    .calculation-details {
      margin-top: 1rem;
      padding: 0.8rem;
      background: #fff3cd;
      border-radius: 4px;
      font-size: 14px;
      color: #856404;
    }
    .error {
      color: #dc3545;
      font-weight: bold;
    }
    .success {
      color: #28a745;
      font-weight: bold;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h2>TikTok日区定价计算器（智能物流版）</h2>
  
  <div class="form-group">
    <label for="cost">商品成本（RMB）</label>
    <input type="number" id="cost" placeholder="例如：25" step="0.01">
  </div>

  <div class="form-group">
    <label for="weight">产品重量（kg）</label>
    <input type="number" id="weight" placeholder="例如：0.5" step="0.1" oninput="updateLogisticsInfo()">
  </div>

  <div class="form-group">
    <label for="cargoType">货物类型</label>
    <select id="cargoType" onchange="updateLogisticsInfo()">
      <option value="普货">普货（标准商品）</option>
      <option value="特货">特货（特殊商品）</option>
      <option value="敏货">敏货（敏感商品）</option>
    </select>
  </div>

  <div class="logistics-info" id="logisticsInfo">
    请输入产品重量以显示物流费信息
  </div>

  <div class="form-group">
    <label for="rate">汇率（日元 / RMB）</label>
    <input type="number" id="rate" value="加载中..." step="0.01">
  </div>

  <div class="form-group">
    <label for="fee">平台+支付手续费率（%）</label>
    <input type="number" id="fee" value="15" step="0.1">
  </div>

  <div class="form-group">
    <label for="profit">利润率（%）</label>
    <input type="number" id="profit" value="30" step="0.1">
  </div>

  <button onclick="calculate()">计算售价</button>

  <div id="result"></div>

  <script>
    // 物流费率表（日元）
    const logisticsRates = {
      "0-1": {
        "普货": { parcel: 530, perKg: 200 },
        "特货": { parcel: 535, perKg: 330 },
        "敏货": { parcel: 535, perKg: 330 }
      },
      "1-2": {
        "普货": { parcel: 520, perKg: 240 },
        "特货": { parcel: 520, perKg: 435 },
        "敏货": { parcel: 520, perKg: 435 }
      },
      "2-5": {
        "普货": { parcel: 510, perKg: 290 },
        "特货": { parcel: 510, perKg: 440 },
        "敏货": { parcel: 510, perKg: 440 }
      },
      "5-10": {
        "普货": { parcel: 500, perKg: 295 },
        "特货": { parcel: 500, perKg: 465 },
        "敏货": { parcel: 500, perKg: 465 }
      }
    };

    // 自动抓取汇率
    window.onload = async function () {
      try {
        const response = await fetch('https://api.exchangerate.host/convert?from=CNY&to=JPY');
        const data = await response.json();
        const rate = data.result;
        document.getElementById('rate').value = rate.toFixed(2);
      } catch (error) {
        document.getElementById('rate').value = 20; // 默认值
        console.log('汇率加载失败，使用默认汇率');
      }
    };

    // 根据重量确定费率区间
    function getWeightRange(weight) {
      if (weight <= 1) return "0-1";
      if (weight <= 2) return "1-2";
      if (weight <= 5) return "2-5";
      if (weight <= 10) return "5-10";
      return null; // 超出范围
    }

    // 计算物流费
    function calculateLogisticsFee(weight, cargoType) {
      const range = getWeightRange(weight);
      if (!range || !logisticsRates[range] || !logisticsRates[range][cargoType]) {
        return null;
      }
      
      const rates = logisticsRates[range][cargoType];
      return rates.parcel + (rates.perKg * weight);
    }

    // 更新物流费信息显示
    function updateLogisticsInfo() {
      const weight = parseFloat(document.getElementById('weight').value);
      const cargoType = document.getElementById('cargoType').value;
      const infoDiv = document.getElementById('logisticsInfo');
      
      if (isNaN(weight) || weight <= 0) {
        infoDiv.innerHTML = '请输入有效的产品重量';
        return;
      }

      if (weight > 10) {
        infoDiv.innerHTML = '<span class="error">重量超出范围（最大10kg），请联系客服获取报价</span>';
        return;
      }

      const range = getWeightRange(weight);
      const logisticsFee = calculateLogisticsFee(weight, cargoType);
      const rates = logisticsRates[range][cargoType];
      
      infoDiv.innerHTML = `
        <strong>物流费计算：</strong><br>
        重量区间：${range}kg | 货物类型：${cargoType}<br>
        包裹费：¥${rates.parcel} + 重量费：¥${rates.perKg} × ${weight}kg = <strong>¥${logisticsFee.toFixed(0)} 日元</strong>
      `;
    }

    function calculate() {
      const cost = parseFloat(document.getElementById('cost').value);
      const weight = parseFloat(document.getElementById('weight').value);
      const cargoType = document.getElementById('cargoType').value;
      const rate = parseFloat(document.getElementById('rate').value);
      const fee = parseFloat(document.getElementById('fee').value) / 100;
      const profit = parseFloat(document.getElementById('profit').value) / 100;

      const resultDiv = document.getElementById('result');

      // 验证输入
      if (isNaN(cost) || isNaN(weight) || isNaN(rate)) {
        resultDiv.innerHTML = '<div class="result"><span class="error">请填写完整的数据</span></div>';
        return;
      }

      if (weight > 10) {
        resultDiv.innerHTML = '<div class="result"><span class="error">重量超出范围（最大10kg），请联系客服获取报价</span></div>';
        return;
      }

      // 计算物流费
      const logisticsFeeJPY = calculateLogisticsFee(weight, cargoType);
      if (logisticsFeeJPY === null) {
        resultDiv.innerHTML = '<div class="result"><span class="error">无法计算物流费，请检查重量和货物类型</span></div>';
        return;
      }

      // 将物流费转换为人民币
      const logisticsFeeRMB = logisticsFeeJPY / rate;
      
      // 计算总成本和最终售价
      const totalCost = cost + logisticsFeeRMB;
      const finalPrice = totalCost * (1 + fee + profit);
      const finalPriceJPY = Math.ceil(finalPrice * rate);

      // 显示详细计算结果
      resultDiv.innerHTML = `
        <div class="result">
          <div class="success">建议售价：¥${finalPriceJPY} 日元</div>
        </div>
        <div class="calculation-details">
          <strong>计算详情：</strong><br>
          商品成本：¥${cost.toFixed(2)} RMB<br>
          物流费：¥${logisticsFeeJPY.toFixed(0)} JPY = ¥${logisticsFeeRMB.toFixed(2)} RMB<br>
          总成本：¥${totalCost.toFixed(2)} RMB<br>
          手续费率：${(fee * 100).toFixed(1)}% | 利润率：${(profit * 100).toFixed(1)}%<br>
          最终售价：¥${finalPrice.toFixed(2)} RMB × ${rate} = <strong>¥${finalPriceJPY} JPY</strong>
        </div>
      `;
    }
  </script>
</body>
</html>

